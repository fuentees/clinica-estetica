generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ======================================================
// 1. CLÍNICAS (SaaS)
// ======================================================
model Clinic {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name     String
  slug     String  @unique
  isActive Boolean @default(true)

  logoUrl      String? @map("logo_url")
  primaryColor String? @map("primary_color")

  cnpj    String?
  phone   String?
  email   String?
  website String?

  cep         String?
  rua         String?
  numero      String?
  bairro      String?
  cidade      String?
  estado      String?
  complemento String?
  address     String?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relacionamentos Principais
  profiles           Profile[]
  patients           Patient[]
  services           Service[]
  procedures         Procedure[]
  appointments       Appointment[]
  budgets            Budget[]
  transactions       Transaction[]
  anamneses          Anamnesis[]
  evolutions         EvolutionRecord[]
  injectablePlans    InjectablePlan[]
  patientTreatments  PatientTreatment[]
  prescriptions      Prescription[]
  settings           SystemSetting[]
  terms              Term[]
  auditLogs          AuditLog[]
  
  // Módulo de Estoque (Adicionado para funcionar o InventoryPage)
  inventory          Inventory[]
  productConsumption ProductConsumption[]

  @@map("clinics")
}

// ======================================================
// 2. PERFIS (USUÁRIOS / PROFISSIONAIS)
// ======================================================
model Profile {
  id    String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email String

  fullName  String? @map("full_name")
  firstName String? @map("first_name")
  lastName  String? @map("last_name")

  avatarUrl String? @map("avatar_url")
  phone     String?

  // Dados Profissionais
  formacao           String?
  registrationNumber String? @map("registration_number")
  bio                String?
  
  commissionRate     Decimal? @default(0) @db.Decimal(10, 2) @map("commission_rate")

  // Configurações de Agenda
  startTime   String? @default("09:00") @map("start_time")
  endTime     String? @default("18:00") @map("end_time")
  agendaColor String? @default("#db2777") @map("agenda_color")
  
  workingDays String[] @default(["Mon", "Tue", "Wed", "Thu", "Fri"]) @map("working_days")
  
  signatureData String?  @map("signature_data")

  // Relacionamentos
  clinicId String? @db.Uuid
  clinic   Clinic? @relation(fields: [clinicId], references: [id])

  roleId String?
  role   Role?   @relation(fields: [roleId], references: [id])

  roleLegacy String @default("paciente") @map("role")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Atividades
  appointments           Appointment[]
  conductedAnamneses     Anamnesis[]
  conductedEvolutions    EvolutionRecord[]
  createdBudgets         Budget[]
  createdInjectablePlans InjectablePlan[]
  prescriptions          Prescription[]
  serviceProfessionals   ServiceProfessional[]
  auditLogs              AuditLog[]
  productConsumptions    ProductConsumption[] // Baixas de estoque realizadas

  @@map("profiles")
}

// ======================================================
// 3. RBAC (Permissões)
// ======================================================
model Role {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?

  profiles    Profile[]
  permissions RolePermission[]

  @@map("roles")
}

model Permission {
  id          String  @id @default(uuid())
  resource    String
  action      String
  description String?

  roles RolePermission[]

  @@unique([resource, action])
  @@map("permissions")
}

model RolePermission {
  id           String @id @default(uuid())
  roleId       String
  permissionId String

  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

// ======================================================
// 4. PACIENTES
// ======================================================
model Patient {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId String @db.Uuid
  clinic   Clinic @relation(fields: [clinicId], references: [id])

  // Vínculo com Login (Adicionado para o Portal do Paciente)
  accountId String? @unique 

  name  String
  phone String
  email String?

  cpf           String?
  date_of_birth String?
  avatar_url    String?

  rg           String?
  idade        Int?
  profissao    String?
  sexo         String?
  estado_civil String?

  cep     String?
  rua     String?
  numero  String?
  bairro  String?
  cidade  String?
  estado  String?
  address String?

  termo_aceito   Boolean @default(false)
  autoriza_foto  Boolean @default(false)
  autoriza_midia Boolean @default(false)

  // === BIOMETRIA ===
  peso            Decimal? @db.Decimal(10, 2)
  altura          Decimal? @db.Decimal(10, 2)
  imc             Decimal? @db.Decimal(10, 2)
  pressaoArterial String?  @map("pressao_arterial")

  // === ANAMNESE: HISTÓRICO E QUEIXA ===
  queixaPrincipal          String? @map("queixa_principal")
  queixaPrincipalDetalhada String? @map("queixa_principal_detalhada")
  tempoQueixa              String? @map("tempo_queixa")
  eventoEspecifico         String? @map("evento_especifico")
  fatoresAgravantes        String? @map("fatores_agravantes")
  fatoresMelhora           String? @map("fatores_melhora")
  tempoEvolucao            String? @map("tempo_evolucao")
  grauIncomodo             String? @map("grau_incomodo")
  tratamentosPreviosLocal  String? @map("tratamentos_previos_local")
  nivelUrgencia            String? @map("nivel_urgencia")
  frequenciaQueixa         String? @map("frequencia_queixa")
  horarioPior              String? @map("horario_pior")
  historicoFamiliar        String? @map("historico_familiar")

  // === ANAMNESE: SAÚDE GERAL ===
  doencasCronicas        String? @map("doencas_cronicas")
  alergiasMedicamentosas String? @map("alergias_medicamentosas")
  procedimentosPrevios   String? @map("procedimentos_previos")
  rotinaSkincare         String? @map("rotina_skincare")
  
  alteracoesHormonais    String? @map("alteracoes_hormonais")
  gestante               Boolean? @default(false)
  lactante               Boolean? @default(false)
  cicloMenstrual         String? @map("ciclo_menstrual")
  metodoContraceptivo    String? @map("metodo_contraceptivo")
  
  fumante                 Boolean? @default(false)
  consumoAlcool           String? @map("consumo_alcool")
  atividadeFisica         Boolean? @default(false) @map("atividade_fisica")
  atividadeFisicaDetalhes String? @map("atividade_fisica_detalhes")
  qualidadeSono           String? @map("qualidade_sono")
  sonoHoras               String? @map("sono_horas")
  ingestaoAgua            String? @map("ingestao_agua")
  ingestaoAguaQtd         String? @map("ingestao_agua_qtd")
  funcionamentoIntestinal String? @map("funcionamento_intestinal")
  alimentacao             String?  
  
  cirurgiasPrevias   String? @map("cirurgias_previas")
  jaFezCirurgia      Boolean? @default(false) @map("ja_fez_cirurgia")
  detalhesCirurgia   String? @map("detalhes_cirurgia")
  oncologico         String? 

  // Medicamentos
  usaMedicacaoContinua   Boolean? @default(false) @map("usa_medicacao_continua")
  listaMedicacoes        String? @map("lista_medicacoes")
  outrasAlergias         String? @map("outras_alergias")

  // Doenças Específicas
  possuiDiabetes            Boolean? @default(false) @map("possui_diabetes")
  possuiHipertensao         Boolean? @default(false) @map("possui_hipertensao")
  doencaHepatica            Boolean? @default(false) @map("doenca_hepatica")
  doencaRenal               String? @map("doenca_renal")
  doencaCardiaca            String? @map("doenca_cardiaca")
  doencaAutoimune           String? @map("doenca_autoimune")
  outrasPatologiasDescricao String? @map("outras_patologias_descricao")
  
  disturbioCirculatorio   String? @map("disturbio_circulatorio")
  disturbioTireoide       String? @map("disturbio_tireoide")
  epilepsia               String? @map("epilepsia")
  
  // Fatores de Risco
  marcaPasso              Boolean? @default(false) @map("marca_passo")
  portadorMarcapasso      String? @map("portador_marcapasso")
  usoAnticoagulante       Boolean? @default(false) @map("uso_anticoagulante")
  usoRetinoide            Boolean? @default(false) @map("uso_retinoide")
  historicoQueloide       Boolean? @default(false) @map("historico_queloide")
  implantesMetalicos      Boolean? @default(false) @map("implantes_metalicos")
  portadorPinosMetalicos  String? @map("portador_pinos_metalicos")
  lentesContato           String? @map("lentes_contato")
  filtroSolarDiario       Boolean? @default(false) @map("filtro_solar_diario")

  // === ANAMNESE: FACIAL ===
  facialFitzpatrick          String? @map("facial_fitzpatrick")
  facialBaumann              String? @map("facial_baumann")
  biotipoCutaneo             String? @map("biotipo_cutaneo")
  facialTextura              String? @map("facial_textura")
  facialAcneGrau             String? @map("facial_acne_grau")
  facialOlheirasTipo         String? @map("facial_olheiras_tipo")
  produtosEmUso              String? @map("produtos_em_uso")
  
  facialLesoes               String? @map("facial_lesoes")
  facialPatologias           String? @map("facial_patologias")
  facialDiscromias           String? @map("facial_discromias")
  facialEnvelhecimento       String? @map("facial_envelhecimento")
  temTelangiectasias         Boolean? @default(false) @map("tem_telangiectasias")
  facialTelangiectasiasLocal String? @map("facial_telangiectasias_local")
  facialDiscromiasLocal      String? @map("facial_discromias_local")
  facialRugasLocal           String? @map("facial_rugas_local")
  locaisManchas              String? @map("locais_manchas")
  locaisAcne                 String? @map("locais_acne")
  locaisFlacidezFacial       String? @map("locais_flacidez_facial")

  // === ANAMNESE: CORPORAL ===
  corporalPostura       String? @map("corporal_postura")
  corporalLipodistrofia String? @map("corporal_lipodistrofia")
  corporalEstrias       String? @map("corporal_estrias")
  corporalFlacidezTipo  String? @map("corporal_flacidez_tipo")
  corporalCeluliteGrau  String? @map("corporal_celulite_grau")
  corporalObservacoes   String? @map("corporal_observacoes")
  
  corporalGorduraLocal   String? @map("corporal_gordura_local")
  corporalCeluliteLocal  String? @map("corporal_celulite_local")
  corporalEstriasLocal   String? @map("corporal_estrias_local")
  corporalFlacidezLocal  String? @map("corporal_flacidez_local")
  locaisGordura          String? @map("locais_gordura")
  locaisCelulite         String? @map("locais_celulite")
  locaisEstrias          String? @map("locais_estrias")
  locaisFlacidezCorporal String? @map("locais_flacidez_corporal")

  // === ANAMNESE: CAPILAR ===
  capilarTipo              String? @map("capilar_tipo")
  capilarFrequenciaLavagem String? @map("capilar_frequencia_lavagem")
  capilarDiametro          String? @map("capilar_diametro")
  capilarOleosidadeFio     String? @map("capilar_oleosidade_fio")
  capilarOleosidadeCouro   String? @map("capilar_oleosidade_couro")
  capilarElasticidade      String? @map("capilar_elasticidade")
  capilarEscalaSavin       String? @map("capilar_escala_savin")
  capilarEscalaNorwood     String? @map("capilar_escala_norwood")
  
  capilarUsaBone     Boolean? @default(false) @map("capilar_usa_bone")
  capilarUsaPreso    Boolean? @default(false) @map("capilar_usa_preso")
  capilarUsaSecador  Boolean? @default(false) @map("capilar_usa_secador")
  capilarUsaChapinha Boolean? @default(false) @map("capilar_usa_chapinha")
  
  capilarDisplasiasCongenitas String? @map("capilar_displasias_congenitas")
  capilarDisplasiasAdquiridas String? @map("capilar_displasias_adquiridas")
  capilarAlopeciaAreata       String? @map("capilar_alopecia_areata")

  // === CAMPOS COMPLEXOS (JSON) ===
  corporalAdipometriaDados Json? @map("corporal_adipometria_dados")
  corporalPerimetriaDados  Json? @map("corporal_perimetria_dados")
  anamnesisBodyMapping     Json? @map("anamnesis_body_mapping")
  
  // Legados
  anamnese_body_mapping Json?
  facial_dados          Json?
  corporal_dados        Json?

  // === RELACIONAMENTOS ===
  consents          PatientTerm[]
  appointments      Appointment[]
  anamneses         Anamnesis[]
  evolutions        EvolutionRecord[]
  budgets           Budget[]
  transactions      Transaction[]
  injectablePlans   InjectablePlan[]
  patientTreatments PatientTreatment[]
  prescriptions     Prescription[]
  aiAnalyses        AnamnesisAIAnalysis[]
  reminders         AppointmentReminder[]
  bioimpedances     BioimpedanceRecord[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("patients")
}


// ======================================================
// 5. MÓDULOS CLÍNICOS E SERVIÇOS
// ======================================================
model Anamnesis {
  id             String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId       String @db.Uuid
  patientId      String @db.Uuid
  professionalId String @db.Uuid

  clinic       Clinic  @relation(fields: [clinicId], references: [id])
  patient      Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
  professional Profile @relation(fields: [professionalId], references: [id])

  mainComplaint    String? @db.Text
  complaintDetails String? @db.Text

  facialData       Json?
  bodyData         Json?
  capilarData      Json?
  lifestyleData    Json?
  bioimpedanceData Json?
  visualMapData    Json?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("anamneses")
}

model EvolutionRecord {
  id             String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId       String @db.Uuid
  patientId      String @db.Uuid
  professionalId String @db.Uuid

  clinic       Clinic  @relation(fields: [clinicId], references: [id])
  patient      Patient @relation(fields: [patientId], references: [id])
  professional Profile @relation(fields: [professionalId], references: [id])

  date        DateTime @default(now())
  subject     String
  description String   @db.Text

  photos      Json?
  attachments Json?

  createdAt DateTime @default(now()) @map("created_at")

  @@map("evolution_records")
}

model Service {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId String @db.Uuid
  clinic   Clinic @relation(fields: [clinicId], references: [id])

  name        String
  category    String
  description String? 
  price       Decimal @db.Decimal(10, 2)
  duration    Int
  isActive    Boolean @default(true)

  professionals     ServiceProfessional[]
  appointments      Appointment[]
  patientTreatments PatientTreatment[]

  @@unique([clinicId, name])
  @@map("services")
}

model ServiceProfessional {
  id        String @id @default(uuid())
  serviceId String @db.Uuid
  profileId String @db.Uuid

  service Service @relation(fields: [serviceId], references: [id])
  profile Profile @relation(fields: [profileId], references: [id])

  commissionRate Decimal? @db.Decimal(5, 2)

  @@unique([serviceId, profileId])
  @@map("service_professionals")
}

model BioimpedanceRecord {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patientId String   @db.Uuid @map("patient_id")
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  date                 DateTime
  weight               Decimal? @db.Decimal(5, 2)
  height               Decimal? @db.Decimal(5, 2)
  bmi                  Decimal? @db.Decimal(5, 2)
  body_fat_percent     Decimal? @db.Decimal(5, 2)
  muscle_mass_kg       Decimal? @db.Decimal(5, 2)
  body_water_percent   Decimal? @db.Decimal(5, 2)
  visceral_fat_level   Int?
  metabolic_age        Int?
  basal_metabolic_rate Int?
  
  cintura              Decimal? @db.Decimal(5, 2)
  abdomen              Decimal? @db.Decimal(5, 2)
  quadril              Decimal? @db.Decimal(5, 2)
  braco_dir            Decimal? @db.Decimal(5, 2)
  coxa_dir             Decimal? @db.Decimal(5, 2)

  createdAt DateTime @default(now()) @map("created_at")

  @@map("bioimpedance_records")
}

model Appointment {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId String @db.Uuid
  clinic   Clinic @relation(fields: [clinicId], references: [id])

  startAt   DateTime @map("start_time") 
  endAt     DateTime @map("end_time")

  status    String   @default("scheduled")
  notes     String?
  price     Decimal? @db.Decimal(10, 2) // Campo necessário para comissões

  patientId      String  @db.Uuid @map("patient_id")
  professionalId String  @db.Uuid @map("professional_id")
  serviceId      String? @db.Uuid @map("service_id")

  // Relacionamentos
  patient      Patient  @relation(fields: [patientId], references: [id])
  professional Profile  @relation(fields: [professionalId], references: [id])
  service      Service? @relation(fields: [serviceId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@index([clinicId, startAt])
  @@index([professionalId, startAt])
  
  @@map("appointments")
}

// ======================================================
// 6. TRATAMENTOS, PLANOS E EVOLUÇÕES
// ======================================================

// IA e Planejamento de Injetáveis
model InjectablePlan {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId    String   @db.Uuid
  patientId   String   @db.Uuid
  createdById String?  @db.Uuid @map("created_by")

  date             DateTime @default(now())
  toxinaUnidades   Json?    @map("toxina_unidades")
  preenchimento    Json?    @map("preenchimento")
  recomendacaoIA   Json?    @map("recomendacao_ia")
  observacoes      String?  @db.Text

  clinic    Clinic   @relation(fields: [clinicId], references: [id])
  patient   Patient  @relation(fields: [patientId], references: [id])
  createdBy Profile? @relation(fields: [createdById], references: [id])

  createdAt DateTime @default(now()) @map("created_at")

  @@map("injectable_plans")
}

// Monitoramento Contínuo (Galeria de Fotos / Pacotes)
model PatientTreatment {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId  String   @db.Uuid
  patientId String   @db.Uuid
  serviceId String?  @db.Uuid @map("service_id")

  status    String   @default("active") 
  startDate DateTime @default(now()) @map("start_date")
  notes     String?

  photos    String[] @default([]) 

  clinic    Clinic   @relation(fields: [clinicId], references: [id])
  patient   Patient  @relation(fields: [patientId], references: [id])
  service   Service? @relation(fields: [serviceId], references: [id])

  progressRecords TreatmentProgress[]

  @@map("patient_treatments")
}

// Evolução Diária (Registro de Sessões)
model TreatmentProgress {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  treatmentId String   @db.Uuid @map("treatment_id")

  progressNotes    String   @map("progress_notes")
  measurements     String? 
  sideEffects      String?  @map("side_effects")
  recommendations  String? 
  nextSessionNotes String?  @map("next_session_notes")

  recordedAt       DateTime @default(now()) @map("recorded_at")

  treatment PatientTreatment @relation(fields: [treatmentId], references: [id], onDelete: Cascade)

  @@map("treatment_progress")
}

// ======================================================
// 7. INVENTÁRIO E CONSUMO (ESTOQUE)
// ======================================================
model Inventory {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId         String   @db.Uuid
  name             String
  description      String?
  quantity         Int      @default(0)
  minimum_quantity Int      @default(0)
  unit_price       Decimal  @default(0) @db.Decimal(10, 2)
  
  clinic           Clinic   @relation(fields: [clinicId], references: [id])
  consumption      ProductConsumption[]

  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("inventory")
}

model ProductConsumption {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId        String   @db.Uuid
  inventoryId     String   @db.Uuid
  professionalId  String?  @db.Uuid
  quantity        Int
  notes           String?
  createdAt       DateTime @default(now()) @map("created_at")

  clinic          Clinic    @relation(fields: [clinicId], references: [id])
  inventory       Inventory @relation(fields: [inventoryId], references: [id])
  profiles        Profile?  @relation(fields: [professionalId], references: [id])

  @@map("product_consumption")
}

// ======================================================
// 8. RECEITUÁRIO
// ======================================================
model Prescription {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId       String   @db.Uuid
  patientId      String   @db.Uuid
  professionalId String   @db.Uuid

  clinic       Clinic    @relation(fields: [clinicId], references: [id])
  patient      Patient   @relation(fields: [patientId], references: [id])
  professional Profile   @relation(fields: [professionalId], references: [id])

  date         DateTime @default(now())
  // Estrutura do JSON: [{ name, dosage, frequency, duration, instructions }]
  medications Json      
  notes       String?  @db.Text
  
  validUntil  DateTime? @map("valid_until")
  signature   String?   

  createdAt DateTime @default(now()) @map("created_at")

  @@map("prescriptions")
}

// ======================================================
// 9. FINANCEIRO E SISTEMA
// ======================================================
model Budget {
  id             String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId       String @db.Uuid
  patientId      String @db.Uuid
  professionalId String @db.Uuid

  clinic       Clinic  @relation(fields: [clinicId], references: [id])
  patient      Patient @relation(fields: [patientId], references: [id])
  professional Profile @relation(fields: [professionalId], references: [id])

  items    Json
  subtotal Decimal @db.Decimal(10, 2)
  discount Decimal @default(0) @db.Decimal(10, 2)
  total    Decimal @db.Decimal(10, 2)

  status       String    @default("pending")
  valid_until DateTime?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("budgets")
}

model Transaction {
  id        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId  String  @db.Uuid
  patientId String? @db.Uuid

  clinic  Clinic   @relation(fields: [clinicId], references: [id])
  patient Patient? @relation(fields: [patientId], references: [id])

  type           String
  category       String?
  description    String
  amount         Decimal @db.Decimal(10, 2)
  payment_method String?

  due_date DateTime
  paid_at  DateTime?

  createdAt DateTime @default(now()) @map("created_at")

  @@map("transactions")
}

model AnamnesisAIAnalysis {
  id        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patientId String  @db.Uuid
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)

  anamnesis_data       Json
  ai_suggestions       String? @db.Text
  risk_factors         Json?
  suggested_treatments Json?
  confidence_score     Int     @default(0)
  status               String  @default("completed")

  createdAt DateTime @default(now()) @map("created_at")

  @@map("anamnesis_ai_analysis")
}

model AppointmentReminder {
  id             String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  appointment_id String @db.Uuid

  patient_id String  @db.Uuid
  patient    Patient @relation(fields: [patient_id], references: [id], onDelete: Cascade)

  to            String
  status        String    @default("pending")
  retry_count   Int       @default(0)
  error_message String?
  scheduled_for DateTime
  sent_at       DateTime?

  createdAt DateTime @default(now()) @map("created_at")

  @@map("appointment_reminders")
}

model Term {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId String @db.Uuid
  clinic   Clinic @relation(fields: [clinicId], references: [id])

  type     String
  title    String
  content  String @db.Text
  version  String
  isActive Boolean @default(true)

  acceptedBy PatientTerm[]
  createdAt  DateTime      @default(now()) @map("created_at")

  @@map("terms")
}

model PatientTerm {
  id        String @id @default(uuid())
  patientId String @db.Uuid
  termId    String @db.Uuid

  patient    Patient  @relation(fields: [patientId], references: [id])
  term       Term     @relation(fields: [termId], references: [id])
  acceptedAt DateTime @default(now())

  @@map("patient_terms")
}

model SystemSetting {
  key      String
  value    String
  clinicId String @db.Uuid
  clinic   Clinic @relation(fields: [clinicId], references: [id])

  @@id([clinicId, key])
  @@map("system_settings")
}

model AuditLog {
  id        String  @id @default(uuid())
  clinicId  String  @db.Uuid
  profileId String? @db.Uuid

  clinic  Clinic   @relation(fields: [clinicId], references: [id])
  profile Profile? @relation(fields: [profileId], references: [id])

  action    String
  entity    String
  entityId  String?
  severity  String   @default("INFO")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([clinicId])
  @@map("audit_logs")
}

model ProfessionalAvailabilityException {
  id             String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  professionalId String @db.Uuid

  start_date  String
  end_date    String
  start_time  String?
  end_time    String?
  is_full_day Boolean @default(true)
  reason      String?

  created_at DateTime @default(now())

  @@map("professional_availability_exceptions")
}

model Procedure {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicId String? @db.Uuid
  clinic   Clinic? @relation(fields: [clinicId], references: [id])

  name        String
  category    String
  price       Decimal @db.Decimal(10, 2)
  description String?
  active      Boolean @default(true)

  createdAt DateTime @default(now()) @map("created_at")

  @@map("procedures")
}